<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>카카오 로그인 콜백</title>
</head>
<body>
  <h1>카카오 로그인 처리 중...</h1>
  <p id="status">잠시만 기다려주세요...</p>

  <script>
    // URL에서 code 파라미터 추출
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');  // 카카오로부터 받은 인증 코드

    if (!code) {
      document.getElementById('status').innerText = '인증 코드가 없습니다.';
    } else {
      // 서버로 인증 코드를 전송하여 토큰 요청
      fetch('http://localhost:3000/auth/kakao/token', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ code: code })
      })
      .then(response => response.json())
      .then(data => {
        if (data.accessToken) {
          document.getElementById('status').innerText = '로그인 성공!';
          // accessToken을 서버로 다시 전송하여 사용자 정보 요청 (예시)
          fetch('http://localhost:3000/auth/kakao/callback', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ token: data.accessToken })
          })
          .then(response => response.json())
          .then(userData => {
            console.log('User Info:', userData);
            document.getElementById('status').innerText = `안녕하세요, ${userData.userInfo.kakao_account.profile.nickname}님!`;
          })
          .catch(error => {
            console.error('사용자 정보 요청 실패:', error);
            document.getElementById('status').innerText = '사용자 정보를 가져오는 데 실패했습니다.';
          });
        } else {
          document.getElementById('status').innerText = '로그인 실패. 액세스 토큰을 받지 못했습니다.';
        }
      })
      .catch(error => {
        console.error('토큰 요청 실패:', error);
        document.getElementById('status').innerText = '토큰을 가져오는 데 실패했습니다.';
      });
    }
  </script>
</body>
</html>
